
module.exports = function(connect, Gamify) {
	var store = connect.Store || connect.session.Store;
	
	
	
	var manager = function() {
		Gamify.log("db", Gamify.settings.db);
		this.mongo	= new Gamify.mongo({database:Gamify.settings.db});
		this.mongo.init(function() {
			
		});
		this.collection	= "s";
	}
	manager.prototype.__proto__ = store.prototype;
	
	manager.prototype.get = function(sid, callback) {
		Gamify.log("get()",sid);
		this.mongo.find({
			collection:		this.collection,
			query:	{
				sid:	sid
			}
		}, function(response, err) {
			if (response.length == 0) {
				callback(err);
			} else {
				callback(null, response[0]);
			}
		});
	}
	manager.prototype.set = function(sid, data, callback) {
		Gamify.log("set()",[sid, data]);
		
		this.mongo.update({
			collection:		this.collection,
			query:	{
				sid:	sid
			},
			data:	{
				$set:	{
					data:		data,
					usedAt:		new Date(),
					expires:	new Date(new Date().getTime()+1000*60*60*24*14)
				}
			},
			options:	{
				upsert:	true
			}
		}, function(response) {
			callback(null);
		});
	}
	manager.prototype.destroy = function(_id, callback) {
		Gamify.log("destroy()",_id);
		callback(null);
	}
	
	return manager;
};
